<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
        <link rel="stylesheet" href="css/leaflet-measure.css">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <style>
          html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            font-family: 'Poppins', sans-serif;
          }

          #judul-container {
            position: absolute;
            top: 20px;
            left: 50px;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(5px);
            padding: 5px 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 999999;
            animation: fadeInSoft 2s ease-out;
          }

          #logo-desa {
            height: 60px;
            object-fit: contain;
            margin-right: 10px;
          }

          #judul-animasi {
            font-family: 'Poppins', sans-serif;
            font-size: 30px;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
          }

          @media (max-width: 768px) {
            #judul-container {
              left: 10px;
              padding: 8px 20px;
              top: 10px;
            }
            #judul-animasi {
              font-size: 20px;
            }
            #logo-desa {
              height: 40px;
            }
          }

          .toggle-visual {
            position: absolute;
            top: 80px;
            right: 290px;
            z-index: 10000;
            background: rgba(255,255,255,0.85);
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
          }

          #info-box {
            position: absolute;
            top: 130px;
            right: 20px;
            width: 260px;
            background: rgba(255, 255, 255, 0.85);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            backdrop-filter: blur(6px);
            display: none;
            z-index: 9999;
          }

          #info-box h3 {
            margin-top: 0;
            font-size: 16px;
            text-align: center;
            color: #2c3e50;
            font-weight: 600;
          }

          .stat-header {
            background: #2f333a;
            padding: 6px 12px;
            border-radius: 20px;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 12px;
            color: white;
          }

          .stat-box {
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            text-align: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
          }

          .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: white;
          }

          .stat-label {
            font-size: 13px;
            color: #bbbbbb;
            margin-top: 4px;
          }

          canvas {
            display: block;
            margin: 10px auto;
          }
        </style>
    </head>
    <body>
        <div id="map"></div>

        <div id="judul-container">
            <img id="logo-desa" src="img/logo_desa.png" alt="Logo Desa">
            <div id="judul-animasi">PETA TEMATIK DESA AIR BELO</div>
        </div>

        <div class="toggle-visual" onclick="toggleVisual()">Tampilkan Visualisasi</div>

        <div id="info-box">
            <h3>Informasi Penduduk</h3>
            <div class="stat-header">üìç Desa Air Belo</div>
            <div class="stat-box">
                <div class="stat-value" id="jumlah-penduduk">0</div>
                <div class="stat-label">Jumlah Penduduk</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="persen-industri">0%</div>
                <div class="stat-label">Lapangan Usaha Industri Pengolahan</div>
            </div>
            <canvas id="donutChart" width="200" height="200"></canvas>
        </div>

        <script>
          const data = {
            labels: ['Bekerja', 'Tidak Bekerja'],
            datasets: [{
              label: 'Status Pekerjaan',
              data: [750, 484],
              backgroundColor: ['rgb(75, 192, 192)', 'rgb(255, 99, 132)'],
              hoverOffset: 4
            }]
          };

          const config = {
            type: 'doughnut',
            data: data,
            options: {
              responsive: true,
              cutout: '40%',
              plugins: {
                legend: {
                  position: 'bottom',
                  labels: {
                    font: {
                      size: 12
                    }
                  }
                }
              }
            }
          };

          const donutChart = new Chart(
            document.getElementById('donutChart'),
            config
          );

          function animateValue(id, start, end, duration, suffix = '') {
            const obj = document.getElementById(id);
            let startTimestamp = null;
            const step = (timestamp) => {
              if (!startTimestamp) startTimestamp = timestamp;
              const progress = Math.min((timestamp - startTimestamp) / duration, 1);
              const value = suffix === '%' ? (progress * (end - start) + start).toFixed(2) : Math.floor(progress * (end - start) + start);
              obj.innerHTML = value.toLocaleString() + suffix;
              if (progress < 1) {
                window.requestAnimationFrame(step);
              }
            };
            window.requestAnimationFrame(step);
          }

          function toggleVisual() {
            const box = document.getElementById('info-box');
            const btn = document.querySelector('.toggle-visual');
            if (box.style.display === 'none') {
              box.style.display = 'block';
              btn.innerText = 'Sembunyikan Visualisasi';
              animateValue('jumlah-penduduk', 0, 1234, 1500);
              animateValue('persen-industri', 0, 28.75, 1500, '%');
            } else {
              box.style.display = 'none';
              btn.innerText = 'Tampilkan Visualisasi';
            }
          }
        </script>
    </body>
</html>
